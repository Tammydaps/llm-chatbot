<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>chatbot_v2.ai.style_engine &mdash; CCL Chatbot Project 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            CCL Chatbot Project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">api package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../chatbot_v2.html">chatbot_v2 package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../database.html">database package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guardrails.html">guardrails package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">CCL Chatbot Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">chatbot_v2.ai.style_engine</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for chatbot_v2.ai.style_engine</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module: style_engine.py</span>

<span class="sd">Module for language style correction and interpretation based on an editorial style guide manual.</span>

<span class="sd">Classes:</span>
<span class="sd">    - StyleGuideParser: Pydantic BaseModel for parsing style guide suggestions.</span>
<span class="sd">    - StyleGuideParserV2: Pydantic BaseModel for parsing style guide suggestions (alternate version).</span>
<span class="sd">    - StyleGuide: A class for generating and managing style guide information.</span>

<span class="sd">Functions:</span>
<span class="sd">    - styleguide_modify_input: Modify input text based on style guide suggestions.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span><span class="p">,</span> <span class="n">HumanMessagePromptTemplate</span>
<span class="kn">from</span> <span class="nn">langchain.schema.messages</span> <span class="kn">import</span> <span class="n">SystemMessage</span>
<span class="kn">from</span> <span class="nn">langchain.output_parsers</span> <span class="kn">import</span> <span class="n">PydanticOutputParser</span>
<span class="kn">from</span> <span class="nn">chatbot_v2.configs.constants</span> <span class="kn">import</span> <span class="n">MODEL_NAME</span>


<div class="viewcode-block" id="StyleGuideParser">
<a class="viewcode-back" href="../../../chatbot_v2.ai.html#chatbot_v2.ai.style_engine.StyleGuideParser">[docs]</a>
<span class="k">class</span> <span class="nc">StyleGuideParser</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pydantic BaseModel for parsing style guide suggestions.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        corrected_text (str): Suggested correction for the input text.</span>
<span class="sd">        explanation (Dict[str, Union[str, List[str]]]): Explanation for the correction under different context headers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">corrected_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Suggest a simple modification/correction for the input, keep the corrected text precise as close as possible to the input. DO NOT make up additional text&quot;</span>
    <span class="p">)</span>
    <span class="n">explanation</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;In this field, several language style guide context headers will be provided, you will return a dictionary output as follows.</span>
<span class="s2">                                              Keys: You most only list the provided context headers that were found applicable for editing and modifying the given input, DO NOT mention any header that was not found applicable for corrections.</span>
<span class="s2">                                              Values: As values carefully explain under each context header that was found applicable, the different rules that was considered while making the corrections to provide the user with a rational explanation for your corrections.&quot;&quot;&quot;</span>
    <span class="p">)</span>  <span class="c1"># as value answer correctly if the rule was followed with a Yes, No or Not Applicable. Do not mention any rule that was not applied.</span></div>



<div class="viewcode-block" id="StyleGuideParserV2">
<a class="viewcode-back" href="../../../chatbot_v2.ai.html#chatbot_v2.ai.style_engine.StyleGuideParserV2">[docs]</a>
<span class="k">class</span> <span class="nc">StyleGuideParserV2</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pydantic BaseModel for parsing style guide suggestions (alternate version).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        corrected_text (str): Suggested correction for the input text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">corrected_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Suggest a simple modification/correction for the input, keep the corrected text precise as close as possible to the input. DO NOT make up additional text&quot;</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="StyleGuide">
<a class="viewcode-back" href="../../../chatbot_v2.ai.html#chatbot_v2.ai.style_engine.StyleGuide">[docs]</a>
<span class="k">class</span> <span class="nc">StyleGuide</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for generating and managing style guide information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the StyleGuide class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_files</span><span class="p">()</span>

<div class="viewcode-block" id="StyleGuide.read_style_guide_files">
<a class="viewcode-back" href="../../../chatbot_v2.ai.html#chatbot_v2.ai.style_engine.StyleGuide.read_style_guide_files">[docs]</a>
    <span class="k">def</span> <span class="nf">read_style_guide_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read and store contents of style guide files.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            path (List[str]): List of file paths.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, str]: Dictionary containing file contents indexed by file path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file_contents</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">file_path</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">path</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">file_contents</span></div>


<div class="viewcode-block" id="StyleGuide.load_files">
<a class="viewcode-back" href="../../../chatbot_v2.ai.html#chatbot_v2.ai.style_engine.StyleGuide.load_files">[docs]</a>
    <span class="k">def</span> <span class="nf">load_files</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load style guide files into memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;style_guide&quot;</span><span class="p">,</span> <span class="s2">&quot;*.txt&quot;</span><span class="p">)</span>
            <span class="n">file_path</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_dir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_style_guide_files</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="StyleGuide.generate_chat_template">
<a class="viewcode-back" href="../../../chatbot_v2.ai.html#chatbot_v2.ai.style_engine.StyleGuide.generate_chat_template">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_chat_template</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a chat template based on style guide context.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Generated chat template.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;style_guide&quot;</span><span class="p">)</span>
        <span class="n">ellipses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;ELLIPSES (…).txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">alphabetisation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;ALPHABETISATION.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">dashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;DASHES AND HYPHENS.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">bulleting</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;BULLETED AND NUMBERED LISTS.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">ampersand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;AMPERSANDS (&amp;).txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">dates_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;DATES AND TIMES.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">quotation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;QUOTATION MARKS.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">brackets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;BRACKETS () [].txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">foreign_words</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;FOREIGN WORDS.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">gender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span>
                         <span class="s2">&quot;GENDER AND INCLUSIVE LANGUAGE.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">slashes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;SLASHES.txt&quot;</span><span class="p">)]</span>
        <span class="n">spellings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;SPELLINGS.txt&quot;</span><span class="p">)]</span>
        <span class="n">business_emails</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;BASICS OF A BUSINESS EMAIL.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">acronyms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;ACRONYMS.txt&quot;</span><span class="p">)]</span>
        <span class="n">capitalization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;CAPITALISATION.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">full_stops</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;FULL STOPS (.).txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">apostrophies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;APOSTROPHES.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">money</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;MONEY.txt&quot;</span><span class="p">)]</span>
        <span class="n">abbreviation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span>
                         <span class="s2">&quot;ABBREVIATIONS, TITLES, AND CONTRACT.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">figures_tables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;FIGURES AND TABLES.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">numbers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;NUMBERS.txt&quot;</span><span class="p">)]</span>
        <span class="n">commas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;COMMAS (,).txt&quot;</span><span class="p">)]</span>
        <span class="n">parallelism</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;PARALLELISM.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">colons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;COLONS AND SEMICOLONS.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_contents</span><span class="p">[</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_directory</span><span class="p">,</span> <span class="s2">&quot;CONTACT DETAILS.txt&quot;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">guide_template_context</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; </span>

<span class="s2">        &quot;# CONTEXT HEADERS&quot;: Here are different style guide context hearders for consideration</span>

<span class="s2">        &quot;dates_time context&quot;</span>
<span class="s2">        </span><span class="si">{dates_time_context}</span>

<span class="s2">        &quot;quotation context&quot;</span>
<span class="s2">        </span><span class="si">{quotation_context}</span>

<span class="s2">        &quot;brackets context&quot;</span>
<span class="s2">        </span><span class="si">{brackets_context}</span>

<span class="s2">        &quot;foreign_words context&quot;</span>
<span class="s2">        </span><span class="si">{foreign_words_context}</span>

<span class="s2">        &quot;gender context&quot;</span>
<span class="s2">        </span><span class="si">{gender_context}</span>

<span class="s2">        &quot;slashes context&quot;</span>
<span class="s2">        </span><span class="si">{slashes_context}</span>

<span class="s2">        &quot;business_emails context&quot;</span>
<span class="s2">        </span><span class="si">{business_emails_context}</span>

<span class="s2">        &quot;acronyms context&quot;</span>
<span class="s2">        </span><span class="si">{acronyms_context}</span>

<span class="s2">        &quot;spellings context&quot; </span>
<span class="s2">        </span><span class="si">{spellings_context}</span>

<span class="s2">        &quot;capitalization context&quot;</span>
<span class="s2">        </span><span class="si">{capitalization_context}</span>

<span class="s2">        &quot;full_stops context&quot;</span>
<span class="s2">        </span><span class="si">{full_stops_context}</span>

<span class="s2">        &quot;apostrophies context&quot;</span>
<span class="s2">        </span><span class="si">{apostrophies_context}</span>

<span class="s2">        &quot;money context&quot;</span>
<span class="s2">        </span><span class="si">{money_context}</span>

<span class="s2">        &quot;abbreviation context&quot;</span>
<span class="s2">        </span><span class="si">{abbreviation_context}</span>

<span class="s2">        &quot;numbers context&quot;</span>
<span class="s2">        </span><span class="si">{numbers_context}</span>

<span class="s2">        &quot;commas context&quot;</span>
<span class="s2">        </span><span class="si">{commas_context}</span>

<span class="s2">        &quot;colons context&quot;</span>
<span class="s2">        </span><span class="si">{colons_context}</span>

<span class="s2">        &quot;contacts context&quot;</span>
<span class="s2">        </span><span class="si">{contacts_context}</span>

<span class="s2">        &quot;ellipses context&quot;</span>
<span class="s2">        </span><span class="si">{ellipses_context}</span>

<span class="s2">        &quot;dashes context&quot;</span>
<span class="s2">        </span><span class="si">{dashes_context}</span>

<span class="s2">        &quot;bulleting context&quot;</span>
<span class="s2">        </span><span class="si">{bulleting_context}</span>

<span class="s2">        &quot;parallelism context&quot;</span>
<span class="s2">        </span><span class="si">{parallelism_context}</span>

<span class="s2">        &quot;figures_tables context&quot;</span>
<span class="s2">        </span><span class="si">{figures_tables_context}</span>

<span class="s2">        &quot;ampersand context&quot;</span>
<span class="s2">        </span><span class="si">{ampersand_context}</span>
<span class="s2">        </span>
<span class="s2">        &quot;alphabetisation context&quot;</span>
<span class="s2">        </span><span class="si">{alphabetisation_context}</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">alphabetisation_context</span><span class="o">=</span><span class="n">alphabetisation</span><span class="p">,</span>
            <span class="n">parallelism_context</span><span class="o">=</span><span class="n">parallelism</span><span class="p">,</span>
            <span class="n">figures_tables_context</span><span class="o">=</span><span class="n">figures_tables</span><span class="p">,</span>
            <span class="n">ampersand_context</span><span class="o">=</span><span class="n">ampersand</span><span class="p">,</span>
            <span class="n">ellipses_context</span><span class="o">=</span><span class="n">ellipses</span><span class="p">,</span>
            <span class="n">dashes_context</span><span class="o">=</span><span class="n">dashes</span><span class="p">,</span>
            <span class="n">bulleting_context</span><span class="o">=</span><span class="n">bulleting</span><span class="p">,</span>
            <span class="n">dates_time_context</span><span class="o">=</span><span class="n">dates_time</span><span class="p">,</span>
            <span class="n">quotation_context</span><span class="o">=</span><span class="n">quotation</span><span class="p">,</span>
            <span class="n">brackets_context</span><span class="o">=</span><span class="n">brackets</span><span class="p">,</span>
            <span class="n">foreign_words_context</span><span class="o">=</span><span class="n">foreign_words</span><span class="p">,</span>
            <span class="n">gender_context</span><span class="o">=</span><span class="n">gender</span><span class="p">,</span>
            <span class="n">slashes_context</span><span class="o">=</span><span class="n">slashes</span><span class="p">,</span>
            <span class="n">business_emails_context</span><span class="o">=</span><span class="n">business_emails</span><span class="p">,</span>
            <span class="n">acronyms_context</span><span class="o">=</span><span class="n">acronyms</span><span class="p">,</span>
            <span class="n">spellings_context</span><span class="o">=</span><span class="n">spellings</span><span class="p">,</span>
            <span class="n">capitalization_context</span><span class="o">=</span><span class="n">capitalization</span><span class="p">,</span>
            <span class="n">full_stops_context</span><span class="o">=</span><span class="n">full_stops</span><span class="p">,</span>
            <span class="n">apostrophies_context</span><span class="o">=</span><span class="n">apostrophies</span><span class="p">,</span>
            <span class="n">money_context</span><span class="o">=</span><span class="n">money</span><span class="p">,</span>
            <span class="n">abbreviation_context</span><span class="o">=</span><span class="n">abbreviation</span><span class="p">,</span>
            <span class="n">numbers_context</span><span class="o">=</span><span class="n">numbers</span><span class="p">,</span>
            <span class="n">commas_context</span><span class="o">=</span><span class="n">commas</span><span class="p">,</span>
            <span class="n">colons_context</span><span class="o">=</span><span class="n">colons</span><span class="p">,</span>
            <span class="n">contacts_context</span><span class="o">=</span><span class="n">contacts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">guide_template_context</span></div>


<div class="viewcode-block" id="StyleGuide.styleguide_modify_input">
<a class="viewcode-back" href="../../../chatbot_v2.ai.html#chatbot_v2.ai.style_engine.StyleGuide.styleguide_modify_input">[docs]</a>
    <span class="k">def</span> <span class="nf">styleguide_modify_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basemodel_class</span><span class="p">:</span> <span class="n">BaseModel</span> <span class="o">=</span> <span class="n">StyleGuideParserV2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify input text based on style guide suggestions.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            basemodel_class (BaseModel, optional): Pydantic BaseModel for parsing style guide suggestions. Defaults to StyleGuideParserV2.</span>

<span class="sd">        Returns:</span>
<span class="sd">            chain: A chain for modifying input text based on style guide suggestions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chat_model</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">MODEL_NAME</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">streaming</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">PydanticOutputParser</span><span class="p">(</span><span class="n">pydantic_object</span><span class="o">=</span><span class="n">basemodel_class</span><span class="p">)</span>
        <span class="n">format_instructions</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">get_format_instructions</span><span class="p">()</span>
        <span class="n">style_guide_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_chat_template</span><span class="p">()</span>
        <span class="n">human_style_context</span> <span class="o">=</span> <span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        You are a Language Engine, you are tasked with validating, correcting, and interpreting user mistakes in a text inputs, in accordance with a set of intructions provided in an editorial style guide manual.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
            <span class="o">+</span> <span class="n">style_guide_context</span>
            <span class="o">+</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &quot;INPUT&quot;: </span><span class="si">{input}</span>
<span class="s2">        &quot;OUTPUT&quot;:</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="n">system_template</span> <span class="o">=</span> <span class="n">SystemMessage</span><span class="p">(</span>
            <span class="n">content</span><span class="o">=</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;You are an intelligent Language engine, you will provide helpful language related corrections.</span>
<span class="sd">                Your default language is British English, all spellings must be in British English&quot;&quot;&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">chat_prompt_template</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">(</span>
            <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
                <span class="n">system_template</span><span class="p">,</span>
                <span class="n">HumanMessagePromptTemplate</span><span class="o">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">human_style_context</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">input_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">],</span>
            <span class="n">partial_variables</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;format_instructions&quot;</span><span class="p">:</span> <span class="n">format_instructions</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="n">chain</span> <span class="o">=</span> <span class="n">chat_prompt_template</span> <span class="o">|</span> <span class="n">chat_model</span>
        <span class="k">return</span> <span class="n">chain</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Digitalization Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>